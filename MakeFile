.PHONY: push                     # single target

# ---------------------------------------------------------------------------
# Timestamp (cross-platform)
# ---------------------------------------------------------------------------
ifeq ($(OS),Windows_NT)          # any flavour of Windows
  TIMESTAMP := $(shell powershell -NoLogo -NoProfile -Command "Get-Date -Format 'yyyy-MM-dd HH:mm'")
else                             # Linux / macOS / WSL
  TIMESTAMP := $(shell date '+%Y-%m-%d %H:%M')
endif

# ---------------------------------------------------------------------------
# User-tweakable variables
# ---------------------------------------------------------------------------
msg    ?= rendering $(TIMESTAMP) # override with  msg="your text"
render ?= true                   # override with  render=false

# ---------------------------------------------------------------------------
# Recipe
# ---------------------------------------------------------------------------
push:
ifeq ($(render),true)
	@echo ">> Running quarto render 🧀"
	@quarto render
else
	@echo ">> Skipping quarto render"
endif
	@echo ">> Staging changes 🧀🧀"
	@git add .
	@echo ">> Committing with message: '$(msg)' 🧀🧀🧀"
	@git commit -m "$(msg)"
	@echo ">> Pushing to remote 🧀🧀🧀🧀"
	@git push
	@echo ">> Done 🧀🧀🧀🧀🧀"
