


ifeq ($(OS),Windows_NT)          # any flavour of Windows
  TIMESTAMP := $(shell powershell -NoLogo -NoProfile -Command "Get-Date -Format 'yyyy-MM-dd HH:mm'")
else                             # Linux / macOS / WSL
  TIMESTAMP := $(shell date '+%Y-%m-%d %H:%M')
endif

msg    ?= rendering $(TIMESTAMP) # override with  msg="your text"
render ?= true                   # override with  render=false
all    ?= false                  # override with  all=true to render everything

push:
	@echo "0. Check if Apr added something and my git push will fail ğŸ§€"
	@git pull
	@echo "1. Staging and committing current changes ğŸ§€ğŸ§€"
	@git add .
	@git commit -m "$(msg)" || echo "No changes to commit"
ifeq ($(render),true)
	@echo "2. Running quarto render ğŸ§€ğŸ§€ğŸ§€"
ifeq ($(all),true)
	@echo "   Rendering ALL files..."
	@quarto render
else
	@echo "   Rendering only changed files..."
	@python render_only_changed.py
endif
	@echo "3. Staging rendered changes ğŸ§€ğŸ§€ğŸ§€ğŸ§€"
	@git add .
	@echo "4. Committing rendered files with message: 'render $(TIMESTAMP)' ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€"
	@git commit -m "render $(TIMESTAMP)" || echo "No rendered changes to commit"
else
	@echo "2. Skipping quarto render"
endif
	@echo "5. Pushing to remote ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€"
	@git push
	@echo "6. Done ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€ğŸ§€"
	@echo "https://hayktarkhanyan.github.io/python_math_ml_course/"
